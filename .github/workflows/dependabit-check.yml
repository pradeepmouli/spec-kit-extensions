name: Dependabit - Check Dependencies

on:
  schedule:
    - cron: '0 2 * * *' # Daily at 2 AM UTC
  workflow_dispatch:
    inputs:
      force_check:
        description: 'Force check all dependencies (ignore schedules)'
        required: false
        default: false
        type: boolean
      severity_filter:
        description: 'Minimum severity to report'
        required: false
        default: minor
        type: choice
        options:
          - minor
          - major
          - breaking

permissions:
  contents: read
  issues: write

jobs:
  check:
    runs-on: ubuntu-latest
    name: Check for Dependency Changes

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check manifest exists
        id: manifest_check
        run: |
          if [ -f ".dependabit/manifest.json" ]; then
            echo "exists=true" >> $GITHUB_OUTPUT
          else
            echo "exists=false" >> $GITHUB_OUTPUT
            echo "::warning::No manifest found. Run the generate workflow first."
          fi

      - name: Validate manifest
        id: validate
        if: steps.manifest_check.outputs.exists == 'true'
        uses: pradeepmouli/dependabit@master
        with:
          action: validate
          manifest_path: .dependabit/manifest.json
          config_path: .dependabit/config.yml

      - name: Summary
        if: always() && steps.manifest_check.outputs.exists == 'true'
        run: |
          echo "### Dependency Validation Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Manifest Validated**: ${{ steps.validate.outcome == 'success' && 'Yes' || 'No' }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "_Note: The automated dependency **check** step is currently disabled because the \`check\` action mode is not yet implemented in \`pradeepmouli/dependabit\`._" >> $GITHUB_STEP_SUMMARY

      - name: No manifest warning
        if: steps.manifest_check.outputs.exists == 'false'
        run: |
          echo "### No Manifest Found" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Run the **Dependabit - Generate Manifest** workflow first." >> $GITHUB_STEP_SUMMARY
